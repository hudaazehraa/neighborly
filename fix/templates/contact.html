{% extends 'base.html' %}
{% load static %}
{% block title %}Contact | Neighborly - Community Management{% endblock %}
{% block content %}

<!-- Contact Hero Section -->
<section class="breadcrumb-section" data-aos="fade-up">
  <div class="contact-container">
    <h1 class="breadcrumb-title">Get in Touch with Us</h1>
    <p class="breadcrumb-subtitle">We’re here to help! Contact us for any inquiries or support.</p>
  </div>
</section>

<section class="contact-hero-section">
  <div class="container contact-hero-flex">
    
    <!-- Contact Info -->
    <div class="contact-info" data-aos="fade-right">
      <div class="contact-info-box">
        <div class="icon">
          <img src="{% static 'images/email.png' %}" alt="Email Icon" class="contact-info-icon">
        </div>
        <div>
          <h4>Email</h4>
          <a href="mailto:stemedge.edu@gmail.com">stemedge.edu@gmail.com</a>
        </div>
      </div>
      <div class="contact-info-box">
        <div class="icon">
          <img src="{% static 'images/phone.png' %}" alt="Phone Icon" class="contact-info-icon">  
        </div>
        <div>
          <h4>Phone</h4>
          <a href="tel:+1234567890">+1 (234) 567-890</a>
        </div>
      </div>
      <div class="contact-info-box">
        <div class="icon">
          <img src="{% static 'images/location1.png' %}" alt="Location Icon" class="contact-info-icon">
        </div>
        <div>
          <h4>Location</h4>
          <p>Karachi, Pakistan</p>
        </div>
      </div>
    </div>

    <!-- Contact Form -->
    <div class="contact-form" data-aos="fade-left">
      <form id="contactForm" method="post" action="{% url 'contact' %}">
      {% csrf_token %}
        <div class="form-group">
  <input
    type="text"
    name="name"
    id="id_name"
    placeholder="Your Name"
    class="form-control"
    value="{{ form.name.value|default_if_none:'' }}"
  />
  <div class="error-message" id="nameError"></div>
</div>

<div class="form-group">
  <input
    type="email"
    name="email"
    id="id_email"
    placeholder="Email Address"
    class="form-control"
    value="{{ form.email.value|default_if_none:'' }}"
  />
  <div class="error-message" id="emailError"></div>
</div>

<!-- <div class="form-group">
  <input
    type="text"
    name="subject"
    id="id_subject"
    placeholder="Subject"
    class="form-control"
    value="{{ form.subject.value|default_if_none:'' }}"/>
  <div class="error-message" id="subjectError"></div>
</div> -->

<div class="form-group">
  <textarea
    name="message"
    id="id_message"
    placeholder="Your Message"
    class="form-control"
    rows="5"
  >{{ form.message.value|default_if_none:'' }}</textarea>
  <div class="error-message" id="messageError"></div>
</div>

  <button type="submit" class="btn-primary">Send Message</button>
</form>

    </div>

  </div>
</section>

<!-- FAQ Section -->
<section class="faq-section" id="faq"data-aos="fade-up">
  <div class="container-faq">
    <h2 class="section-title2">Frequently Asked Questions</h2>
    <p class="breadcrumb-subtitle2">Your clarity is our priority—our FAQs ensure you get the information you need, when you need it.</p>
    <div class="faq-item" data-aos="fade-up" data-aos-delay="100">
      <div class="faq-question">
        <span>How do I report an issue?</span>
        <div class="faq-icon"><i class="fas fa-plus"></i></div>
      </div>
      <div class="faq-answer">Log in to your account and use the complaint form to submit your issue directly to the admin team.</div>
    </div>
    <hr class="divider2">
    <div class="faq-item" data-aos="fade-up" data-aos-delay="200">
      <div class="faq-question">
        <span>Can I track my complaint status?</span>
        <div class="faq-icon"><i class="fas fa-plus"></i></div>
      </div>
      <div class="faq-answer">Yes, each submitted complaint has a status you can monitor under your profile dashboard.</div>
    </div>
    <hr class="divider2">
    <div class="faq-item" data-aos="fade-up" data-aos-delay="300">
      <div class="faq-question">
        <span>Is my personal information secure?</span>
        <div class="faq-icon"><i class="fas fa-plus"></i></div>
      </div>
      <div class="faq-answer">We use secure encryption and verification to protect your data from unauthorized access.</div>
    </div>
    <hr class="divider2">
  </div>
</section>

<!-- jQuery -->

<script>
$(function() {

    /* ========== CSRF Token Setup for Django ========== */
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    /* ========== FAQ Accordion ========== */
    $('.faq-question').on('click', function () {
        let $answer = $(this).next('.faq-answer');
        let $icon = $(this).find('.faq-icon i');

        if ($answer.is(':visible')) {
            $answer.slideUp();
            $icon.removeClass('fa-minus').addClass('fa-plus');
        } else {
            $('.faq-answer').slideUp();
            $('.faq-icon i').removeClass('fa-minus').addClass('fa-plus');
            $answer.slideDown();
            $icon.removeClass('fa-plus').addClass('fa-minus');
        }
    });

    /* ========== Contact Form Validation & AJAX ========== */
    $('#contactForm').on('submit', function(e) {
        e.preventDefault();

        let $form = $(this);
        let $btn = $form.find('button[type="submit"]');
        let isValid = true;

        // Clear old errors
        $('.error-message').text('');

        let name = $('#id_name').val().trim();
        let email = $('#id_email').val().trim();
        let message = $('#id_message').val().trim();

        // Name validation
        if (!name) {
            $('#nameError').text('Please enter your name');
            isValid = false;
        } else if (!/^[A-Za-z\s]+$/.test(name)) {
            $('#nameError').text('Name must contain only letters and spaces');
            isValid = false;
        }

        // Email validation
        if (!email) {
            $('#emailError').text('Please enter your email');
            isValid = false;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            $('#emailError').text('Enter a valid email address');
            isValid = false;
        }

        // Message validation
        if (!message) {
            $('#messageError').text('Please enter your message');
            isValid = false;
        }

        if (!isValid) return;

        // Submit via AJAX with CSRF
        $btn.text("Please wait...").prop("disabled", true);

        $.ajax({
            url: $form.attr("action"),
            type: "POST",
            data: $form.serialize(),
            headers: { "X-CSRFToken": csrftoken },
            success: function(response) {
                $form.fadeOut(300, function() {
                    $('<div class="success-message">')
                        .html(`${response.message} ✅`)
                        .css({
                            padding: '20px',
                            background: '#e8e9fa',
                            color: '#155724',
                            borderRadius: '12px',
                            marginTop: '64px',
                            textAlign: 'center',
                            fontSize: '18px'
                        })
                        .insertAfter($form);
                });
            },
            error: function() {
                alert("Something went wrong. Please try again.");
                $btn.text("Send Message").prop("disabled", false);
            }
        });
    });

});


</script>

{% endblock %}